<!DOCTYPE html>
<html>
<head>
    <title>Event Scanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="config.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/platform.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        button {
            padding: 15px;
            width: 100%;
            font-size: 18px;
            margin-bottom: 12px;
        }

        #log {
            margin-top: 20px;
            font-size: 18px;
            color: green;
            min-height: 40px;
        }
    </style>
</head>

<body>

<h2>Scan for Event</h2>

<button onclick="startScan('Event 1')">Scan for Event 1</button>
<button onclick="startScan('Event 2')">Scan for Event 2</button>
<button onclick="startScan('Event 3')">Scan for Event 3</button>
<button onclick="startScan('Event 4')">Scan for Event 4</button>
<button onclick="startScan('Event 5')">Scan for Event 5</button>

<p id="log"></p>

<script>

// Load Google API
function initClient() {
    gapi.client
        .init({
            apiKey: 813185029300-ej2m0qrpae9kucc0b2b89phu1l2poc7u.apps.googleusercontent.com,
            clientId: AIzaSyDjeOD1iJJ16hDIG0_gLBpPCTmqzW0KxAk,
            scope: https://www.googleapis.com/auth/spreadsheets,
            discoveryDocs: [
                "https://sheets.googleapis.com/$discovery/rest?version=v4"
            ],
        })
        .then(() => console.log("Google API Ready"));
}

gapi.load("client:auth2", initClient);


// -----------------------------------------------------
// START NFC SCAN
// -----------------------------------------------------
async function startScan(eventName) {

    document.getElementById("log").innerText =
        `Scanning for ${eventName}… Tap NFC card`;

    try {
        const ndef = new NDEFReader();
        await ndef.scan();

        ndef.onreading = async (event) => {
            const record = event.message.records[0];
            const cardid = new TextDecoder().decode(record.data);

            document.getElementById("log").innerText =
                `Card detected: ${cardid} → Saving…`;

            await saveEventToSheet(cardid, eventName);

            document.getElementById("log").innerText =
                `✔ ${cardid} logged for ${eventName}`;
        };

    }
    catch (error) {
  alert("NFC Write Error: " + JSON.stringify(error));
  console.error(error);
}

}


// -----------------------------------------------------
// SAVE EVENT RECORD INTO GOOGLE SHEET
// -----------------------------------------------------
async function saveEventToSheet(cardid, eventName) {
    const now = new Date().toLocaleString();
    const scannerName = "Scanner Device"; // You may customize per device

    return gapi.client.sheets.spreadsheets.values.append({
        spreadsheetId: /d/1Vp3kqDAZNHwYD-AHiYjM5ry646Bd6J5GhKFUe71J7hA/edit?gid=1843599820#gid=1843599820,
        range: "Sheet1!A:E",
        valueInputOption: "RAW",
        insertDataOption: "INSERT_ROWS",
        resource: {
            values: [[now, cardid, "", eventName, scannerName]],
        },
    });
}

</script>

</body>
</html>
